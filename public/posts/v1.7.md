Today we are releasing Deno 1.7.0. This release contains many new features, some
stabilizations, a some great improvements to existing APIs and tooling.

- [**Support of data URL imports**](#):
- [**DNS querying via `Deno.resolveDns`**](#):
- [**Improvements to `deno compile`**](#):

If you already have Deno installed you can upgrade to 1.7 by running
`deno upgrade`. If you are installing Deno for the first time, you can use one
of the methods listed below:

```shell
# Using Shell (macOS and Linux):
curl -fsSL https://deno.land/x/install/install.sh | sh

# Using PowerShell (Windows):
iwr https://deno.land/x/install/install.ps1 -useb | iex

# Using Homebrew (macOS):
brew install deno

# Using Scoop (Windows):
scoop install deno

# Using Chocolatey (Windows):
choco install deno
```

# New features and changes

## Support for importing data URLs

Bartek

needs example

## Improvements to `deno compile`

Luca

- flags
- lite binary
- cross compile

needs example

## Internal compiler APIs become `Deno.emit`

Bartek

needs example

## Add `Deno.resolveDns` API

Luca

needs example

## Markdown support in `deno fmt`

Bartek

## Align WHATWG Streams API to spec

Luca

- mention `ReadableStream#getIterator` upgrade path

needs diff of how to adjust for getIterator

## Support for configurable web worker permissions

Bartek

- configurable permissions for workers

needs example

## Add support for `globalThis.location` and relative fetch

Luca

- examples of why useful

needs example

## Improvements to coverage

Bartek

## Support for `fetch` request body streaming

Next to our support for streaming response bodies in `fetch`, we now also
support streaming request bodies. This can be used to upload a large file to a
webserver, without first having to buffer it in memory. This can be done by
passing a `ReadableStream` to the `body` field in the `fetch` options.

```ts
import { readableStreamFromAsyncIterator } from "https://deno.land/std@0.84.0/io/streams.ts";

// Open the file we want to upload to the server.
const file = await Deno.open("./large_file_on_disk.txt");

// Construct a `ReadableStream` from the `Deno.Reader` returned by `Deno.open`.
const body = readableStreamFromAsyncIterator(Deno.iter(file));

// Send the body to the server.
const res = await fetch("https://myfileserver.com/upload", {
  method: "POST",
  body,
});
```

Currently the only runtimes supporting fetch upload streaming are Chromium and
Deno. Both implementations have a limitation where you can not start recieving
the response body until the request body has been fully sent. This is not a
limitation in the Fetch specification, rather in the implementations, and will
be addressed in the future. For some more examples and usecases for fetch upload
streaming take a look at [Jake Archibald's](https://twitter.com/jaffathecake)
post on the matter: https://web.dev/fetch-upload-streaming/.

## Add TLS session cache

Bartek

## Improvements to `deno lsp`

Luca

## Add support for utf-16 and big5 encoding

Bartek

## Changes to Deno APIs

We are happy to stabilize `Deno.shutdown` in this release. This function lets
you shut down a socket cleanly (so flushing all data before closing). This can
be called instead of `Deno.close` for supported sockets. Unlike the unstable
version of this API, no socket mode has to be specified when shutting down, as
you only can only really shut down the write end of a socket.

In this release the signature of the option bag for the unstable
`Deno.createHttpClient` API has changed. This API can be used to customize how a
fetch is executed. Instead of being able to specify `caFile` (the path to a file
containing a custom CA certificate), you now specify `caData`. This means you
can now use in memory certificates for `Deno.createHttpClient`.

```diff
- const client = Deno.createHttpClient({ caFile: "./my_ca.pem" });
- const res = await fetch("https://my.kubernetes:4443", { client })
+ const client = Deno.createHttpClient({ caData: Deno.readFileSync("./my_ca.pem") });
+ const res = await fetch("https://my.kubernetes:4443", { client })
```

The unstable `Deno.permission` APIs for the `net` permission have also changed
slightly. Instead of taking / returning a `url` parameter, we now use `host`, to
match what the `--allow-net` flag supports.

```diff
- await Deno.permissions.query({ name: "net", url: "localhost:4000" });
+ await Deno.permissions.query({ name: "net", host: "localhost:4000" });
```

## Tokio 1.0

Bartek

# Other news

Luca

- wpt issue call to action
- link to survey
- link to 2020 recap post
